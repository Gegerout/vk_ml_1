# Профильное задание № 1, ML - разработчик

Этот проект реализует сервис обработки документов, который читает сообщения из Kafka, обрабатывает их и записывает
обратно в Kafka.

## Установка и настройка

### Требования

- Python 3.8+
- Kafka

### Установка зависимостей

Установите необходимые зависимости с помощью pip:

```bash
pip install -r requirements.txt
```

## Запуск Kafka

- Запустите Zookeeper:

```bash
.\bin\windows\zookeeper-server-start.bat .\config\zookeeper.properties
```

- Запустите Kafka:

```bash
.\bin\windows\kafka-server-start.bat .\config\server.properties
```

## Создание топиков в Kafka

Создайте топики input и output:

```bash
.\bin\windows\kafka-topics.bat --create --topic input --bootstrap-server localhost:9092
.\bin\windows\kafka-topics.bat --create --topic output --bootstrap-server localhost:9092
```

## Запуск consumer

Запустите скрипт `consume_and_produce.py`, чтобы начать чтение сообщений из топика input, обработку и запись в топик
output:

```bash
python src/consume_and_produce.py
```
## Тестирование
### Запуск тестов
Для запуска тестов используйте команду:

```bash
python -m unittest discover -s tests
```

## Структура проекта
- `src/`
    - `TDocument.py`: Описание структуры документа и методы для преобразования в/из JSON.
    - `database.py`: Реализация взаимодействия с базой данных для хранения документов.
    - `processor.py`: Логика обработки документов.
    - `consume_and_produce.py`: Скрипт для чтения сообщений из Kafka, обработки и записи обратно в Kafka.
    - `read_output.py`: Скрипт для чтения сообщений из топика output.
- `tests/`
  - `test_processor.py`: Тесты для проверки логики процессора.

## Примеры использования
### Отправка сообщений в Kafka
Для отправки сообщений в Kafka используйте скрипт `send_messages.py`:

```bash
python src/send_messages.py
```
Скрипт отправит заранее определенные сообщения в топик input. Вы можете изменить или добавить сообщения в скрипт по своему усмотрению.

### Чтение сообщений из Kafka
Для чтения сообщений из топика output используйте скрипт `read_output.py`:

```bash
python src/read_output.py
```
Скрипт будет выводить сообщения, обработанные и записанные в топик output.

## База данных
### Назначение
База данных используется для хранения документов, которые были обработаны сервисом. Она позволяет эффективно управлять версиями документов, определяя поля Text, PubDate, и FirstFetchTime в соответствии с требованиями задачи.
### Вид базы данных
База данных реализована с помощью SQLite, что обеспечивает простоту настройки и использования в локальной среде разработки. SQLite - это легковесная реляционная база данных, которая хранит все данные в одном файле и не требует настройки серверного окружения.
### Структура базы данных
База данных содержит одну таблицу `documents`, которая хранит следующие поля:

- `Url`: Строка, уникальный идентификатор документа.
- `PubDate`: Целое число, время заявляемой публикации документа.
- `FetchTime`: Целое число, время получения данного обновления документа.
- `Text`: Текст документа.
- `FirstFetchTime`: Целое число, время первого получения документа.
### Схема таблицы
```sql
CREATE TABLE documents (
    Url TEXT PRIMARY KEY,
    PubDate INTEGER,
    FetchTime INTEGER,
    Text TEXT,
    FirstFetchTime INTEGER
);
```
